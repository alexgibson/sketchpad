!function(e){e.fn.sketchpad=function(o){var t,n,i,s,r=this,a=e.extend({colors:{r:0,g:0,b:0,a:1},started:!1,moved:!1,size:10,lines:[],pixelRatio:1},o),l={changeColor:function(e,o,t,n){a.colors.r=e,a.colors.g=o,a.colors.b=t,a.colors.a=n},changeSize:function(e,o){o===!0?(console.log(a.size),a.size>0&&a.size+e>0&&(a.size+=e)):a.size=e},init:function(){console.log(a);var e=null,o=new Image,i="localStorage"in window&&null!==window.localStorage;pixelRatio=this.getPixelRatio(),t=document.createElement("canvas"),r.append(t),t.setAttribute("height",parseInt(r.css("height"))),t.setAttribute("width",parseInt(r.css("width"))),t.getContext?(n=t.getContext("2d"),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),t.addEventListener("mousedown",this.onMouseDown,!1)):alert("Your browser does not support Canvas 2D drawing."),document.addEventListener("touchmove",function(e){e.preventDefault()},!1),window.addEventListener("shake",this.clearCanvas,!1),i&&(e=localStorage.getItem("sketchpad"),e&&(o.onload=function(){n.drawImage(o,0,0)},o.src=e))},getPixelRatio:function(){return"devicePixelRatio"in window?window.devicePixelRatio:1},onTouchStart:function(e){e.preventDefault(),_.each(e.touches,function(e){a.lines[e.identifier]={x:e.clientX,y:e.clientY}},this),a.moved=!1,a.started=!0},onTouchMove:function(e){e.preventDefault(),a.started&&_.each(e.touches,function(e){console.log(e);var o=e.identifier,t=e.clientX-a.lines[o].x,n=e.clientY-a.lines[o].y,i=l.drawMulti(o,t,n);a.lines[o].x=i.x,a.lines[o].y=i.y},this),a.moved=!0},onTouchEnd:function(e){0===e.touches.length&&(a.lines=[],a.moved=!1,a.started=!1)},onTouchCancel:function(e){0===e.touches.length&&(a.lines=[],a.moved=!1,a.started=!1)},onMouseDown:function(){a.moved=!1,a.started=!0,t.addEventListener("mousemove",l.onMouseMove,!1),t.addEventListener("mouseup",l.onMouseUp,!1)},onMouseMove:function(e){if(a.started){console.log(e);var o=e.offsetX,t=e.offsetY;l.drawLine(o,t)}a.moved=!0},onMouseUp:function(){l.endDraw(),a.moved=!1,a.started=!1,t.removeEventListener("mousemove",this.onMouseMove,!1),t.removeEventListener("mouseup",this.onMouseUp,!1)},drawLine:function(e,o){i&&s||(i=e,s=o),console.log("x: "+i+", y: "+s),n.lineCap="round",n.lineJoin="round",n.lineWidth=a.size,n.strokeStyle="rgba("+a.colors.r+","+a.colors.g+","+a.colors.b+","+a.colors.a+")",n.globalCompositeOperation="source-over",n.beginPath(),n.moveTo(i,s),n.lineTo(e,o),n.stroke(),n.closePath(),i=e,s=o},endDraw:function(){i=null,s=null},drawMulti:function(e,o,t){return n.lineCap="round",n.lineJoin="round",n.lineWidth=a.size,n.strokeStyle="rgba("+a.colors.r+","+a.colors.g+","+a.colors.b+","+a.colors.a+")",n.globalCompositeOperation="source-over",n.beginPath(),n.moveTo(a.lines[e].x,a.lines[e].y),n.lineTo(a.lines[e].x+o,a.lines[e].y+t),n.stroke(),n.closePath(),{x:a.lines[e].x+o,y:a.lines[e].y+t}},clearCanvas:function(){confirm("Clear the drawing?")&&(t.setAttribute("height",a.height),t.setAttribute("width",a.width),this.saveImageData())}};return l}}(jQuery);